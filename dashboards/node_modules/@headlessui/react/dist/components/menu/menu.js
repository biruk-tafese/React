"use client";import{useFocusRing as re}from"@react-aria/focus";import{useHover as oe}from"@react-aria/interactions";import b,{Fragment as W,createContext as ae,createRef as X,useContext as ie,useEffect as se,useMemo as U,useReducer as le,useRef as $}from"react";import{useActivePress as ue}from'../../hooks/use-active-press.js';import{useDidElementMove as pe}from'../../hooks/use-did-element-move.js';import{useDisposables as q}from'../../hooks/use-disposables.js';import{useElementSize as de}from'../../hooks/use-element-size.js';import{useEvent as I}from'../../hooks/use-event.js';import{useId as H}from'../../hooks/use-id.js';import{useIsoMorphicEffect as k}from'../../hooks/use-iso-morphic-effect.js';import{useOutsideClick as me}from'../../hooks/use-outside-click.js';import{useOwnerDocument as ce}from'../../hooks/use-owner.js';import{useResolveButtonType as fe}from'../../hooks/use-resolve-button-type.js';import{useSyncRefs as N}from'../../hooks/use-sync-refs.js';import{useTextValue as Te}from'../../hooks/use-text-value.js';import{useTrackedPointer as ye}from'../../hooks/use-tracked-pointer.js';import{useTreeWalker as ge}from'../../hooks/use-tree-walker.js';import{FloatingProvider as Ie,useFloatingPanel as Me,useFloatingPanelProps as Pe,useFloatingReference as Ae,useFloatingReferenceProps as Se}from'../../internal/floating.js';import{Modal as be,ModalFeatures as Ee}from'../../internal/modal.js';import{OpenClosedProvider as Re,State as w,useOpenClosed as ve}from'../../internal/open-closed.js';import{isDisabledReactIssue7711 as xe}from'../../utils/bugs.js';import{Focus as g,calculateActiveIndex as K}from'../../utils/calculate-active-index.js';import{disposables as j}from'../../utils/disposables.js';import{Focus as z,FocusableMode as _e,focusFrom as De,isFocusableElement as Fe,restoreFocusIfNecessary as Y,sortByDomNode as he}from'../../utils/focus-management.js';import{match as Z}from'../../utils/match.js';import{RenderFeatures as ee,forwardRefWithAs as E,mergeProps as te,render as R}from'../../utils/render.js';import{useDescriptions as Ce}from'../description/description.js';import{Keys as y}from'../keyboard.js';import{useLabelContext as Oe,useLabels as ne}from'../label/label.js';import{Portal as Le}from'../portal/portal.js';var Ge=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(Ge||{}),Ue=(n=>(n[n.Pointer=0]="Pointer",n[n.Other=1]="Other",n))(Ue||{}),He=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItem=5]="RegisterItem",t[t.UnregisterItem=6]="UnregisterItem",t))(He||{});function Q(e,o=n=>n){let n=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,i=he(o(e.items.slice()),s=>s.dataRef.current.domRef.current),r=n?i.indexOf(n):null;return r===-1&&(r=null),{items:i,activeItemIndex:r}}let ke={[1](e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},[0](e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},[2]:(e,o)=>{var s,l,t,u,m;if(e.menuState===1)return e;let n={...e,searchQuery:"",activationTrigger:(s=o.trigger)!=null?s:1};if(o.focus===g.Nothing)return{...n,activeItemIndex:null};if(o.focus===g.Specific)return{...n,activeItemIndex:e.items.findIndex(d=>d.id===o.id)};if(o.focus===g.Previous){let d=e.activeItemIndex;if(d!==null){let M=e.items[d].dataRef.current.domRef,f=K(o,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:p=>p.id,resolveDisabled:p=>p.dataRef.current.disabled});if(f!==null){let p=e.items[f].dataRef.current.domRef;if(((l=M.current)==null?void 0:l.previousElementSibling)===p.current||((t=p.current)==null?void 0:t.previousElementSibling)===null)return{...n,activeItemIndex:f}}}}else if(o.focus===g.Next){let d=e.activeItemIndex;if(d!==null){let M=e.items[d].dataRef.current.domRef,f=K(o,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:p=>p.id,resolveDisabled:p=>p.dataRef.current.disabled});if(f!==null){let p=e.items[f].dataRef.current.domRef;if(((u=M.current)==null?void 0:u.nextElementSibling)===p.current||((m=p.current)==null?void 0:m.nextElementSibling)===null)return{...n,activeItemIndex:f}}}}let i=Q(e),r=K(o,{resolveItems:()=>i.items,resolveActiveIndex:()=>i.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...n,...i,activeItemIndex:r}},[3]:(e,o)=>{let i=e.searchQuery!==""?0:1,r=e.searchQuery+o.value.toLowerCase(),l=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+i).concat(e.items.slice(0,e.activeItemIndex+i)):e.items).find(u=>{var m;return((m=u.dataRef.current.textValue)==null?void 0:m.startsWith(r))&&!u.dataRef.current.disabled}),t=l?e.items.indexOf(l):-1;return t===-1||t===e.activeItemIndex?{...e,searchQuery:r}:{...e,searchQuery:r,activeItemIndex:t,activationTrigger:1}},[4](e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},[5]:(e,o)=>{let n=Q(e,i=>[...i,{id:o.id,dataRef:o.dataRef}]);return{...e,...n}},[6]:(e,o)=>{let n=Q(e,i=>{let r=i.findIndex(s=>s.id===o.id);return r!==-1&&i.splice(r,1),i});return{...e,...n,activationTrigger:1}}},J=ae(null);J.displayName="MenuContext";function B(e){let o=ie(J);if(o===null){let n=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,B),n}return o}function Ne(e,o){return Z(o.type,ke,e,o)}let we=W;function Be(e,o){let{__demoMode:n=!1,...i}=e,r=le(Ne,{__demoMode:n,menuState:n?0:1,buttonRef:X(),itemsRef:X(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:s,itemsRef:l,buttonRef:t},u]=r,m=N(o);me([t,l],(p,A)=>{var P;u({type:1}),Fe(A,_e.Loose)||(p.preventDefault(),(P=t.current)==null||P.focus())},s===0);let d=I(()=>{u({type:1})}),M=U(()=>({open:s===0,close:d}),[s,d]),f={ref:m};return b.createElement(Ie,null,b.createElement(J.Provider,{value:r},b.createElement(Re,{value:Z(s,{[0]:w.Open,[1]:w.Closed})},R({ourProps:f,theirProps:i,slot:M,defaultTag:we,name:"Menu"}))))}let We="button";function Ke(e,o){var D,F,h,C;let n=H(),{id:i=`headlessui-menu-button-${n}`,...r}=e,[s,l]=B("Menu.Button"),t=Se(),u=N(s.buttonRef,o,Ae()),m=q(),d=I(c=>{switch(c.key){case y.Space:case y.Enter:case y.ArrowDown:c.preventDefault(),c.stopPropagation(),l({type:0}),m.nextFrame(()=>l({type:2,focus:g.First}));break;case y.ArrowUp:c.preventDefault(),c.stopPropagation(),l({type:0}),m.nextFrame(()=>l({type:2,focus:g.Last}));break}}),M=I(c=>{switch(c.key){case y.Space:c.preventDefault();break}}),f=I(c=>{if(xe(c.currentTarget))return c.preventDefault();e.disabled||(s.menuState===0?(l({type:1}),m.nextFrame(()=>{var T;return(T=s.buttonRef.current)==null?void 0:T.focus({preventScroll:!0})})):(c.preventDefault(),l({type:0})))}),{isFocusVisible:p,focusProps:A}=re({autoFocus:(D=e.autoFocus)!=null?D:!1}),{isHovered:P,hoverProps:S}=oe({isDisabled:(F=e.disabled)!=null?F:!1}),{pressed:v,pressProps:x}=ue({disabled:(h=e.disabled)!=null?h:!1}),_=U(()=>{var c;return{open:s.menuState===0,active:v||s.menuState===0,hover:P,focus:p,autofocus:(c=e.autoFocus)!=null?c:!1}},[s,P,p,v,e.autoFocus]),O=te(t(),{ref:u,id:i,type:fe(e,s.buttonRef),"aria-haspopup":"menu","aria-controls":(C=s.itemsRef.current)==null?void 0:C.id,"aria-expanded":s.menuState===0,onKeyDown:d,onKeyUp:M,onClick:f},A,S,x);return R({ourProps:O,theirProps:r,slot:_,defaultTag:We,name:"Menu.Button"})}let je="div",Qe=ee.RenderStrategy|ee.Static;function Je(e,o){var c,T;let n=H(),{id:i=`headlessui-menu-items-${n}`,anchor:r,modal:s,...l}=e,[t,u]=B("Menu.Items"),[m,d]=Me(r),M=Pe(),f=N(t.itemsRef,o,r?m:null),p=ce(t.itemsRef);r!=null&&s==null?s=!0:s==null&&(s=!1);let A=q(),P=ve(),S=(()=>P!==null?(P&w.Open)===w.Open:t.menuState===0)(),x=pe(t.buttonRef,t.menuState!==0)?!1:S;se(()=>{let a=t.itemsRef.current;a&&t.menuState===0&&a!==(p==null?void 0:p.activeElement)&&a.focus({preventScroll:!0})},[t.menuState,t.itemsRef,p]),ge({container:t.itemsRef.current,enabled:t.menuState===0,accept(a){return a.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:a.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(a){a.setAttribute("role","none")}});let _=I(a=>{var L,V;switch(A.dispose(),a.key){case y.Space:if(t.searchQuery!=="")return a.preventDefault(),a.stopPropagation(),u({type:3,value:a.key});case y.Enter:if(a.preventDefault(),a.stopPropagation(),u({type:1}),t.activeItemIndex!==null){let{dataRef:G}=t.items[t.activeItemIndex];(V=(L=G.current)==null?void 0:L.domRef.current)==null||V.click()}Y(t.buttonRef.current);break;case y.ArrowDown:return a.preventDefault(),a.stopPropagation(),u({type:2,focus:g.Next});case y.ArrowUp:return a.preventDefault(),a.stopPropagation(),u({type:2,focus:g.Previous});case y.Home:case y.PageUp:return a.preventDefault(),a.stopPropagation(),u({type:2,focus:g.First});case y.End:case y.PageDown:return a.preventDefault(),a.stopPropagation(),u({type:2,focus:g.Last});case y.Escape:a.preventDefault(),a.stopPropagation(),u({type:1}),j().nextFrame(()=>{var G;return(G=t.buttonRef.current)==null?void 0:G.focus({preventScroll:!0})});break;case y.Tab:a.preventDefault(),a.stopPropagation(),u({type:1}),j().microTask(()=>{De(t.buttonRef.current,a.shiftKey?z.Previous:z.Next)});break;default:a.key.length===1&&(u({type:3,value:a.key}),A.setTimeout(()=>u({type:4}),350));break}}),O=I(a=>{switch(a.key){case y.Space:a.preventDefault();break}}),D=U(()=>({open:t.menuState===0}),[t]),F=te(r?M():{},{"aria-activedescendant":t.activeItemIndex===null||(c=t.items[t.activeItemIndex])==null?void 0:c.id,"aria-labelledby":(T=t.buttonRef.current)==null?void 0:T.id,id:i,onKeyDown:_,onKeyUp:O,role:"menu",tabIndex:0,ref:f,style:{...d,"--button-width":de(t.buttonRef,!0).width}}),h=s?be:r?Le:W,C=s?{features:Ee.ScrollLock,enabled:t.menuState===0}:{};return b.createElement(h,{...C},R({ourProps:F,theirProps:l,slot:D,defaultTag:je,features:Qe,visible:x,name:"Menu.Items"}))}let Ve=W;function Xe(e,o){let n=H(),{id:i=`headlessui-menu-item-${n}`,disabled:r=!1,...s}=e,[l,t]=B("Menu.Item"),u=l.activeItemIndex!==null?l.items[l.activeItemIndex].id===i:!1,m=$(null),d=N(o,m);k(()=>{if(l.__demoMode||l.menuState!==0||!u||l.activationTrigger===0)return;let T=j();return T.requestAnimationFrame(()=>{var a,L;(L=(a=m.current)==null?void 0:a.scrollIntoView)==null||L.call(a,{block:"nearest"})}),T.dispose},[l.__demoMode,m,u,l.menuState,l.activationTrigger,l.activeItemIndex]);let M=Te(m),f=$({disabled:r,domRef:m,get textValue(){return M()}});k(()=>{f.current.disabled=r},[f,r]),k(()=>(t({type:5,id:i,dataRef:f}),()=>t({type:6,id:i})),[f,i]);let p=I(()=>{t({type:1})}),A=I(T=>{if(r)return T.preventDefault();t({type:1}),Y(l.buttonRef.current)}),P=I(()=>{if(r)return t({type:2,focus:g.Nothing});t({type:2,focus:g.Specific,id:i})}),S=ye(),v=I(T=>{S.update(T),!r&&(u||t({type:2,focus:g.Specific,id:i,trigger:0}))}),x=I(T=>{S.wasMoved(T)&&(r||u||t({type:2,focus:g.Specific,id:i,trigger:0}))}),_=I(T=>{S.wasMoved(T)&&(r||u&&t({type:2,focus:g.Nothing}))}),[O,D]=ne(),[F,h]=Ce(),C=U(()=>({active:u,focus:u,disabled:r,close:p}),[u,r,p]);return b.createElement(D,null,b.createElement(h,null,R({ourProps:{id:i,ref:d,role:"menuitem",tabIndex:r===!0?void 0:-1,"aria-disabled":r===!0?!0:void 0,"aria-labelledby":O,"aria-describedby":F,disabled:void 0,onClick:A,onFocus:P,onPointerEnter:v,onMouseEnter:v,onPointerMove:x,onMouseMove:x,onPointerLeave:_,onMouseLeave:_},theirProps:s,slot:C,defaultTag:Ve,name:"Menu.Item"})))}let $e="div";function qe(e,o){let[n,i]=ne();return b.createElement(i,null,R({ourProps:{ref:o,"aria-labelledby":n,role:"group"},theirProps:e,slot:{},defaultTag:$e,name:"Menu.Section"}))}let ze="header";function Ye(e,o){let n=H(),{id:i=`headlessui-menu-heading-${n}`,...r}=e,s=Oe();k(()=>s.register(i),[i,s.register]);let l={id:i,ref:o,role:"presentation",...s.props};return R({ourProps:l,theirProps:r,slot:{},defaultTag:ze,name:"Menu.Heading"})}let Ze="div";function et(e,o){return R({ourProps:{ref:o,role:"separator"},theirProps:e,slot:{},defaultTag:Ze,name:"Menu.Separator"})}let tt=E(Be),nt=E(Ke),rt=E(Je),ot=E(Xe),at=E(qe),it=E(Ye),st=E(et),kt=Object.assign(tt,{Button:nt,Items:rt,Item:ot,Section:at,Heading:it,Separator:st});export{kt as Menu,nt as MenuButton,it as MenuHeading,ot as MenuItem,rt as MenuItems,at as MenuSection,st as MenuSeparator};
