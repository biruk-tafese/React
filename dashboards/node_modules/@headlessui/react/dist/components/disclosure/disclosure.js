"use client";import{useFocusRing as Y}from"@react-aria/focus";import{useHover as Z}from"@react-aria/interactions";import R,{Fragment as j,createContext as x,useContext as L,useEffect as W,useMemo as b,useReducer as ee,useRef as A}from"react";import{useActivePress as te}from'../../hooks/use-active-press.js';import{useEvent as C}from'../../hooks/use-event.js';import{useId as $}from'../../hooks/use-id.js';import{useResolveButtonType as ne}from'../../hooks/use-resolve-button-type.js';import{optionalRef as oe,useSyncRefs as O}from'../../hooks/use-sync-refs.js';import{OpenClosedProvider as le,State as I,useOpenClosed as se}from'../../internal/open-closed.js';import{isDisabledReactIssue7711 as re}from'../../utils/bugs.js';import{match as _}from'../../utils/match.js';import{getOwnerDocument as ue}from'../../utils/owner.js';import{RenderFeatures as J,forwardRefWithAs as v,mergeProps as X,render as B,useMergeRefsFn as V}from'../../utils/render.js';import{startTransition as ie}from'../../utils/start-transition.js';import{Keys as g}from'../keyboard.js';var ae=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(ae||{}),pe=(t=>(t[t.ToggleDisclosure=0]="ToggleDisclosure",t[t.CloseDisclosure=1]="CloseDisclosure",t[t.SetButtonId=2]="SetButtonId",t[t.SetPanelId=3]="SetPanelId",t[t.LinkPanel=4]="LinkPanel",t[t.UnlinkPanel=5]="UnlinkPanel",t))(pe||{});let ce={[0]:e=>({...e,disclosureState:_(e.disclosureState,{[0]:1,[1]:0})}),[1]:e=>e.disclosureState===1?e:{...e,disclosureState:1},[4](e){return e.linkedPanel===!0?e:{...e,linkedPanel:!0}},[5](e){return e.linkedPanel===!1?e:{...e,linkedPanel:!1}},[2](e,n){return e.buttonId===n.buttonId?e:{...e,buttonId:n.buttonId}},[3](e,n){return e.panelId===n.panelId?e:{...e,panelId:n.panelId}}},F=x(null);F.displayName="DisclosureContext";function k(e){let n=L(F);if(n===null){let l=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,k),l}return n}let M=x(null);M.displayName="DisclosureAPIContext";function q(e){let n=L(M);if(n===null){let l=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,q),l}return n}let H=x(null);H.displayName="DisclosurePanelContext";function de(){return L(H)}function fe(e,n){return _(n.type,ce,e,n)}let Te=j;function De(e,n){let{defaultOpen:l=!1,...i}=e,f=A(null),o=O(n,oe(u=>{f.current=u},e.as===void 0||e.as===j)),t=A(null),d=A(null),r=ee(fe,{disclosureState:l?0:1,linkedPanel:!1,buttonRef:d,panelRef:t,buttonId:null,panelId:null}),[{disclosureState:c,buttonId:a},y]=r,p=C(u=>{y({type:1});let D=ue(f);if(!D||!a)return;let P=(()=>u?u instanceof HTMLElement?u:u.current instanceof HTMLElement?u.current:D.getElementById(a):D.getElementById(a))();P==null||P.focus()}),m=b(()=>({close:p}),[p]),T=b(()=>({open:c===0,close:p}),[c,p]),S={ref:o};return R.createElement(F.Provider,{value:r},R.createElement(M.Provider,{value:m},R.createElement(le,{value:_(c,{[0]:I.Open,[1]:I.Closed})},B({ourProps:S,theirProps:i,slot:T,defaultTag:Te,name:"Disclosure"}))))}let Pe="button";function ye(e,n){var N,G,K;let l=$(),{id:i=`headlessui-disclosure-button-${l}`,...f}=e,[o,t]=k("Disclosure.Button"),d=de(),r=d===null?!1:d===o.panelId,c=A(null),a=O(c,n,r?null:o.buttonRef),y=V();W(()=>{if(!r)return t({type:2,buttonId:i}),()=>{t({type:2,buttonId:null})}},[i,t,r]);let p=C(s=>{var E;if(r){if(o.disclosureState===1)return;switch(s.key){case g.Space:case g.Enter:s.preventDefault(),s.stopPropagation(),t({type:0}),(E=o.buttonRef.current)==null||E.focus();break}}else switch(s.key){case g.Space:case g.Enter:s.preventDefault(),s.stopPropagation(),t({type:0});break}}),m=C(s=>{switch(s.key){case g.Space:s.preventDefault();break}}),T=C(s=>{var E;re(s.currentTarget)||e.disabled||(r?(t({type:0}),(E=o.buttonRef.current)==null||E.focus()):t({type:0}))}),{isFocusVisible:S,focusProps:u}=Y({autoFocus:(N=e.autoFocus)!=null?N:!1}),{isHovered:D,hoverProps:P}=Z({isDisabled:(G=e.disabled)!=null?G:!1}),{pressed:U,pressProps:h}=te({disabled:(K=e.disabled)!=null?K:!1}),z=b(()=>{var s;return{open:o.disclosureState===0,hover:D,active:U,focus:S,autofocus:(s=e.autoFocus)!=null?s:!1}},[o,D,U,S,e.autoFocus]),w=ne(e,c),Q=r?X({ref:a,type:w,onKeyDown:p,onClick:T},u,P,h):X({ref:a,id:i,type:w,"aria-expanded":o.disclosureState===0,"aria-controls":o.linkedPanel?o.panelId:void 0,onKeyDown:p,onKeyUp:m,onClick:T},u,P,h);return B({mergeRefs:y,ourProps:Q,theirProps:f,slot:z,defaultTag:Pe,name:"Disclosure.Button"})}let me="div",Ee=J.RenderStrategy|J.Static;function ge(e,n){let l=$(),{id:i=`headlessui-disclosure-panel-${l}`,...f}=e,[o,t]=k("Disclosure.Panel"),{close:d}=q("Disclosure.Panel"),r=V(),c=O(n,o.panelRef,T=>{ie(()=>t({type:T?4:5}))});W(()=>(t({type:3,panelId:i}),()=>{t({type:3,panelId:null})}),[i,t]);let a=se(),y=(()=>a!==null?(a&I.Open)===I.Open:o.disclosureState===0)(),p=b(()=>({open:o.disclosureState===0,close:d}),[o,d]),m={ref:c,id:i};return R.createElement(H.Provider,{value:o.panelId},B({mergeRefs:r,ourProps:m,theirProps:f,slot:p,defaultTag:me,features:Ee,visible:y,name:"Disclosure.Panel"}))}let Se=v(De),Re=v(ye),be=v(ge),we=Object.assign(Se,{Button:Re,Panel:be});export{we as Disclosure,Re as DisclosureButton,be as DisclosurePanel};
