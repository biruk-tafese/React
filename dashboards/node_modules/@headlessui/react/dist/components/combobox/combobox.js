"use client";import{useFocusRing as ge}from"@react-aria/focus";import{useHover as ve}from"@react-aria/interactions";import{useVirtualizer as Fe}from"@tanstack/react-virtual";import w,{Fragment as Oe,createContext as se,createRef as _e,useCallback as Ce,useContext as de,useMemo as j,useReducer as Ve,useRef as H,useState as De}from"react";import{useActivePress as he}from'../../hooks/use-active-press.js';import{useByComparator as Me}from'../../hooks/use-by-comparator.js';import{useControllable as Le}from'../../hooks/use-controllable.js';import{useDisposables as ye}from'../../hooks/use-disposables.js';import{useEvent as x}from'../../hooks/use-event.js';import{useId as re}from'../../hooks/use-id.js';import{useIsoMorphicEffect as K}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as Be}from'../../hooks/use-latest-value.js';import{useOutsideClick as we}from'../../hooks/use-outside-click.js';import{useOwnerDocument as Ue}from'../../hooks/use-owner.js';import{useResolveButtonType as ke}from'../../hooks/use-resolve-button-type.js';import{useSyncRefs as ae}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as Ne}from'../../hooks/use-tracked-pointer.js';import{useTreeWalker as Ge}from'../../hooks/use-tree-walker.js';import{useWatch as Re}from'../../hooks/use-watch.js';import{useDisabled as He}from'../../internal/disabled.js';import{FloatingProvider as Xe,useFloatingPanel as je,useFloatingPanelProps as Ke,useFloatingReference as Je}from'../../internal/floating.js';import{FormFields as We}from'../../internal/form-fields.js';import{useProvidedId as $e}from'../../internal/id.js';import{OpenClosedProvider as ze,State as ie,useOpenClosed as qe}from'../../internal/open-closed.js';import{history as Ae}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as Ye}from'../../utils/bugs.js';import{Focus as S,calculateActiveIndex as Pe}from'../../utils/calculate-active-index.js';import{disposables as Se}from'../../utils/disposables.js';import{sortByDomNode as Qe}from'../../utils/focus-management.js';import{match as $}from'../../utils/match.js';import{isMobile as Ze}from'../../utils/platform.js';import{RenderFeatures as Ee,forwardRefWithAs as q,mergeProps as be,render as Y}from'../../utils/render.js';import{useDescribedBy as eo}from'../description/description.js';import{Keys as M}from'../keyboard.js';import{Label as oo,useLabelledBy as ce,useLabels as to}from'../label/label.js';var no=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(no||{}),ro=(t=>(t[t.Single=0]="Single",t[t.Multi=1]="Multi",t))(ro||{}),ao=(l=>(l[l.Pointer=0]="Pointer",l[l.Focus=1]="Focus",l[l.Other=2]="Other",l))(ao||{}),io=(a=>(a[a.OpenCombobox=0]="OpenCombobox",a[a.CloseCombobox=1]="CloseCombobox",a[a.GoToOption=2]="GoToOption",a[a.RegisterOption=3]="RegisterOption",a[a.UnregisterOption=4]="UnregisterOption",a[a.SetActivationTrigger=5]="SetActivationTrigger",a[a.UpdateVirtualOptions=6]="UpdateVirtualOptions",a))(io||{});function fe(e,n=t=>t){let t=e.activeOptionIndex!==null?e.options[e.activeOptionIndex]:null,l=n(e.options.slice()),p=l.length>0&&l[0].dataRef.current.order!==null?l.sort((f,a)=>f.dataRef.current.order-a.dataRef.current.order):Qe(l,f=>f.dataRef.current.domRef.current),d=t?p.indexOf(t):null;return d===-1&&(d=null),{options:p,activeOptionIndex:d}}let lo={[1](e){var n;return(n=e.dataRef.current)!=null&&n.disabled||e.comboboxState===1?e:{...e,activeOptionIndex:null,comboboxState:1}},[0](e){var n,t;if((n=e.dataRef.current)!=null&&n.disabled||e.comboboxState===0)return e;if((t=e.dataRef.current)!=null&&t.value){let l=e.dataRef.current.calculateIndex(e.dataRef.current.value);if(l!==-1)return{...e,activeOptionIndex:l,comboboxState:0}}return{...e,comboboxState:0}},[2](e,n){var d,f,a,r,o;if((d=e.dataRef.current)!=null&&d.disabled||(f=e.dataRef.current)!=null&&f.optionsRef.current&&!((a=e.dataRef.current)!=null&&a.optionsPropsRef.current.static)&&e.comboboxState===1)return e;if(e.virtual){let i=n.focus===S.Specific?n.idx:Pe(n,{resolveItems:()=>e.virtual.options,resolveActiveIndex:()=>{var v,m;return(m=(v=e.activeOptionIndex)!=null?v:e.virtual.options.findIndex(b=>!e.virtual.disabled(b)))!=null?m:null},resolveDisabled:e.virtual.disabled,resolveId(){throw new Error("Function not implemented.")}}),E=(r=n.trigger)!=null?r:2;return e.activeOptionIndex===i&&e.activationTrigger===E?e:{...e,activeOptionIndex:i,activationTrigger:E}}let t=fe(e);if(t.activeOptionIndex===null){let i=t.options.findIndex(E=>!E.dataRef.current.disabled);i!==-1&&(t.activeOptionIndex=i)}let l=n.focus===S.Specific?n.idx:Pe(n,{resolveItems:()=>t.options,resolveActiveIndex:()=>t.activeOptionIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.current.disabled}),p=(o=n.trigger)!=null?o:2;return e.activeOptionIndex===l&&e.activationTrigger===p?e:{...e,...t,activeOptionIndex:l,activationTrigger:p}},[3]:(e,n)=>{var d,f,a;if((d=e.dataRef.current)!=null&&d.virtual)return{...e,options:[...e.options,n.payload]};let t=n.payload,l=fe(e,r=>(r.push(t),r));e.activeOptionIndex===null&&(f=e.dataRef.current)!=null&&f.isSelected(n.payload.dataRef.current.value)&&(l.activeOptionIndex=l.options.indexOf(t));let p={...e,...l,activationTrigger:2};return(a=e.dataRef.current)!=null&&a.__demoMode&&e.dataRef.current.value===void 0&&(p.activeOptionIndex=0),p},[4]:(e,n)=>{var l;if((l=e.dataRef.current)!=null&&l.virtual)return{...e,options:e.options.filter(p=>p.id!==n.id)};let t=fe(e,p=>{let d=p.findIndex(f=>f.id===n.id);return d!==-1&&p.splice(d,1),p});return{...e,...t,activationTrigger:2}},[5]:(e,n)=>e.activationTrigger===n.trigger?e:{...e,activationTrigger:n.trigger},[6]:(e,n)=>{var l;if(((l=e.virtual)==null?void 0:l.options)===n.options)return e;let t=e.activeOptionIndex;if(e.activeOptionIndex!==null){let p=n.options.indexOf(e.virtual.options[e.activeOptionIndex]);p!==-1?t=p:t=null}return{...e,activeOptionIndex:t,virtual:Object.assign({},e.virtual,{options:n.options})}}},me=se(null);me.displayName="ComboboxActionsContext";function le(e){let n=de(me);if(n===null){let t=new Error(`<${e} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,le),t}return n}let Ie=se(null);function uo(e){var a;let n=z("VirtualProvider"),[t,l]=j(()=>{let r=n.optionsRef.current;if(!r)return[0,0];let o=window.getComputedStyle(r);return[parseFloat(o.paddingBlockStart||o.paddingTop),parseFloat(o.paddingBlockEnd||o.paddingBottom)]},[n.optionsRef.current]),p=Fe({scrollPaddingStart:t,scrollPaddingEnd:l,count:n.virtual.options.length,estimateSize(){return 40},getScrollElement(){var r;return(r=n.optionsRef.current)!=null?r:null},overscan:12}),[d,f]=De(0);return K(()=>{f(r=>r+1)},[(a=n.virtual)==null?void 0:a.options]),w.createElement(Ie.Provider,{value:p},w.createElement("div",{style:{position:"relative",width:"100%",height:`${p.getTotalSize()}px`},ref:r=>{if(r){if(typeof process!="undefined"&&process.env.JEST_WORKER_ID!==void 0||n.activationTrigger===0)return;n.activeOptionIndex!==null&&n.virtual.options.length>n.activeOptionIndex&&p.scrollToIndex(n.activeOptionIndex)}}},p.getVirtualItems().map(r=>{var o;return w.createElement(Oe,{key:r.key},w.cloneElement((o=e.children)==null?void 0:o.call(e,{option:n.virtual.options[r.index],open:n.comboboxState===0}),{key:`${d}-${r.key}`,"data-index":r.index,"aria-setsize":n.virtual.options.length,"aria-posinset":r.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${r.start}px)`,overflowAnchor:"none"}}))})))}let Te=se(null);Te.displayName="ComboboxDataContext";function z(e){let n=de(Te);if(n===null){let t=new Error(`<${e} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,z),t}return n}function po(e,n){return $(n.type,lo,e,n)}let so=Oe;function bo(e,n){var y,h;let t=He(),{value:l,defaultValue:p,onChange:d,form:f,name:a,by:r,disabled:o=t||!1,__demoMode:i=!1,nullable:E=!1,multiple:v=!1,immediate:m=!1,virtual:b=null,...L}=e,[P=v?[]:void 0,O]=Le(l,d,p),[T,_]=Ve(po,{dataRef:_e(),comboboxState:i?0:1,options:[],virtual:b?{options:b.options,disabled:(y=b.disabled)!=null?y:()=>!1}:null,activeOptionIndex:null,activationTrigger:2}),V=H(!1),k=H({static:!1,hold:!1}),N=H(null),G=H(null),I=H(null),C=Me(r),X=x(c=>b?r===null?b.options.indexOf(c):b.options.findIndex(g=>C(g,c)):T.options.findIndex(g=>C(g.dataRef.current.value,c))),A=Ce(c=>$(s.mode,{[1]:()=>P.some(g=>C(g,c)),[0]:()=>C(P,c)}),[P]),R=x(c=>T.activeOptionIndex===X(c)),s=j(()=>({...T,immediate:m,optionsPropsRef:k,inputRef:N,buttonRef:G,optionsRef:I,value:P,defaultValue:p,disabled:o,mode:v?1:0,virtual:T.virtual,get activeOptionIndex(){if(V.current&&T.activeOptionIndex===null&&(b?b.options.length>0:T.options.length>0)){if(b){let g=b.options.findIndex(U=>{var ne,xe;return!((xe=(ne=b==null?void 0:b.disabled)==null?void 0:ne.call(b,U))!=null&&xe)});if(g!==-1)return g}let c=T.options.findIndex(g=>!g.dataRef.current.disabled);if(c!==-1)return c}return T.activeOptionIndex},calculateIndex:X,compare:C,isSelected:A,isActive:R,nullable:E,__demoMode:i}),[P,p,o,v,E,i,T,b]);K(()=>{b&&_({type:6,options:b.options})},[b,b==null?void 0:b.options]),K(()=>{T.dataRef.current=s},[s]),we([s.buttonRef,s.inputRef,s.optionsRef],()=>W.closeCombobox(),s.comboboxState===0);let ue=j(()=>{var c,g,U;return{open:s.comboboxState===0,disabled:o,activeIndex:s.activeOptionIndex,activeOption:s.activeOptionIndex===null?null:s.virtual?s.virtual.options[(c=s.activeOptionIndex)!=null?c:0]:(U=(g=s.options[s.activeOptionIndex])==null?void 0:g.dataRef.current.value)!=null?U:null,value:P}},[s,o,P]),pe=x(()=>{if(s.activeOptionIndex!==null){if(s.virtual)J(s.virtual.options[s.activeOptionIndex]);else{let{dataRef:c}=s.options[s.activeOptionIndex];J(c.current.value)}W.goToOption(S.Specific,s.activeOptionIndex)}}),Q=x(()=>{_({type:0}),V.current=!0}),Z=x(()=>{_({type:1}),V.current=!1}),ee=x((c,g,U)=>(V.current=!1,c===S.Specific?_({type:2,focus:S.Specific,idx:g,trigger:U}):_({type:2,focus:c,trigger:U}))),oe=x((c,g)=>(_({type:3,payload:{id:c,dataRef:g}}),()=>{s.isActive(g.current.value)&&(V.current=!0),_({type:4,id:c})})),J=x(c=>$(s.mode,{[0](){return O==null?void 0:O(c)},[1](){let g=s.value.slice(),U=g.findIndex(ne=>C(ne,c));return U===-1?g.push(c):g.splice(U,1),O==null?void 0:O(g)}})),te=x(c=>{_({type:5,trigger:c})}),W=j(()=>({onChange:J,registerOption:oe,goToOption:ee,closeCombobox:Z,openCombobox:Q,setActivationTrigger:te,selectActiveOption:pe}),[]),[u,D]=to(),F=n===null?{}:{ref:n},B=Ce(()=>O==null?void 0:O(p),[O]);return w.createElement(D,{value:u,props:{htmlFor:(h=s.inputRef.current)==null?void 0:h.id},slot:{open:s.comboboxState===0,disabled:o}},w.createElement(Xe,null,w.createElement(me.Provider,{value:W},w.createElement(Te.Provider,{value:s},w.createElement(ze,{value:$(s.comboboxState,{[0]:ie.Open,[1]:ie.Closed})},a!=null&&w.createElement(We,{data:P!=null?{[a]:P}:{},form:f,onReset:B}),Y({ourProps:F,theirProps:L,slot:ue,defaultTag:so,name:"Combobox"}))))))}let co="input";function fo(e,n){var Q,Z,ee,oe,J,te,W;let t=re(),l=$e(),{id:p=l||`headlessui-combobox-input-${t}`,onChange:d,displayValue:f,type:a="text",...r}=e,o=z("Combobox.Input"),i=le("Combobox.Input"),E=ae(o.inputRef,n,Je()),v=Ue(o.inputRef),m=H(!1),b=ye(),L=x(()=>{i.onChange(null),o.optionsRef.current&&(o.optionsRef.current.scrollTop=0),i.goToOption(S.Nothing)}),P=function(){var u;return typeof f=="function"&&o.value!==void 0?(u=f(o.value))!=null?u:"":typeof o.value=="string"?o.value:""}();Re(([u,D],[F,B])=>{if(m.current)return;let y=o.inputRef.current;y&&((B===0&&D===1||u!==F)&&(y.value=u),requestAnimationFrame(()=>{if(m.current||!y||(v==null?void 0:v.activeElement)!==y)return;let{selectionStart:h,selectionEnd:c}=y;Math.abs((c!=null?c:0)-(h!=null?h:0))===0&&h===0&&y.setSelectionRange(y.value.length,y.value.length)}))},[P,o.comboboxState,v]),Re(([u],[D])=>{if(u===0&&D===1){if(m.current)return;let F=o.inputRef.current;if(!F)return;let B=F.value,{selectionStart:y,selectionEnd:h,selectionDirection:c}=F;F.value="",F.value=B,c!==null?F.setSelectionRange(y,h,c):F.setSelectionRange(y,h)}},[o.comboboxState]);let O=H(!1),T=x(()=>{O.current=!0}),_=x(()=>{b.nextFrame(()=>{O.current=!1})}),V=x(u=>{switch(m.current=!0,u.key){case M.Enter:if(m.current=!1,o.comboboxState!==0||O.current)return;if(u.preventDefault(),u.stopPropagation(),o.activeOptionIndex===null){i.closeCombobox();return}i.selectActiveOption(),o.mode===0&&i.closeCombobox();break;case M.ArrowDown:return m.current=!1,u.preventDefault(),u.stopPropagation(),$(o.comboboxState,{[0]:()=>i.goToOption(S.Next),[1]:()=>i.openCombobox()});case M.ArrowUp:return m.current=!1,u.preventDefault(),u.stopPropagation(),$(o.comboboxState,{[0]:()=>i.goToOption(S.Previous),[1]:()=>{i.openCombobox(),b.nextFrame(()=>{o.value||i.goToOption(S.Last)})}});case M.Home:if(u.shiftKey)break;return m.current=!1,u.preventDefault(),u.stopPropagation(),i.goToOption(S.First);case M.PageUp:return m.current=!1,u.preventDefault(),u.stopPropagation(),i.goToOption(S.First);case M.End:if(u.shiftKey)break;return m.current=!1,u.preventDefault(),u.stopPropagation(),i.goToOption(S.Last);case M.PageDown:return m.current=!1,u.preventDefault(),u.stopPropagation(),i.goToOption(S.Last);case M.Escape:return m.current=!1,o.comboboxState!==0?void 0:(u.preventDefault(),o.optionsRef.current&&!o.optionsPropsRef.current.static&&u.stopPropagation(),o.nullable&&o.mode===0&&o.value===null&&L(),i.closeCombobox());case M.Tab:if(m.current=!1,o.comboboxState!==0)return;o.mode===0&&o.activationTrigger!==1&&i.selectActiveOption(),i.closeCombobox();break}}),k=x(u=>{d==null||d(u),o.nullable&&o.mode===0&&u.target.value===""&&L(),i.openCombobox()}),N=x(u=>{var F,B,y;let D=(F=u.relatedTarget)!=null?F:Ae.find(h=>h!==u.currentTarget);if(m.current=!1,!((B=o.optionsRef.current)!=null&&B.contains(D))&&!((y=o.buttonRef.current)!=null&&y.contains(D))&&o.comboboxState===0)return u.preventDefault(),o.mode===0&&(o.nullable&&o.value===null?L():o.activationTrigger!==1&&i.selectActiveOption()),i.closeCombobox()}),G=x(u=>{var F,B,y;let D=(F=u.relatedTarget)!=null?F:Ae.find(h=>h!==u.currentTarget);(B=o.buttonRef.current)!=null&&B.contains(D)||(y=o.optionsRef.current)!=null&&y.contains(D)||o.disabled||o.immediate&&o.comboboxState!==0&&(i.openCombobox(),b.nextFrame(()=>{i.setActivationTrigger(1)}))}),I=ce(),C=eo(),{isFocusVisible:X,focusProps:A}=ge({isTextInput:!0,autoFocus:(Q=e.autoFocus)!=null?Q:!1}),{isHovered:R,hoverProps:s}=ve({isDisabled:(Z=o.disabled)!=null?Z:!1}),ue=j(()=>{var u;return{open:o.comboboxState===0,disabled:o.disabled,hover:R,focus:X,autofocus:(u=e.autoFocus)!=null?u:!1}},[o,R,X,e.autoFocus]),pe=be({ref:E,id:p,role:"combobox",type:a,"aria-controls":(ee=o.optionsRef.current)==null?void 0:ee.id,"aria-expanded":o.comboboxState===0,"aria-activedescendant":o.activeOptionIndex===null?void 0:o.virtual?(oe=o.options.find(u=>{var D;return!((D=o.virtual)!=null&&D.disabled(u.dataRef.current.value))&&o.compare(u.dataRef.current.value,o.virtual.options[o.activeOptionIndex])}))==null?void 0:oe.id:(J=o.options[o.activeOptionIndex])==null?void 0:J.id,"aria-labelledby":I,"aria-describedby":C,"aria-autocomplete":"list",defaultValue:(W=(te=e.defaultValue)!=null?te:o.defaultValue!==void 0?f==null?void 0:f(o.defaultValue):null)!=null?W:o.defaultValue,disabled:o.disabled,onCompositionStart:T,onCompositionEnd:_,onKeyDown:V,onChange:k,onFocus:G,onBlur:N},A,s);return Y({ourProps:pe,theirProps:r,slot:ue,defaultTag:co,name:"Combobox.Input"})}let mo="button";function To(e,n){var V,k,N,G;let t=z("Combobox.Button"),l=le("Combobox.Button"),p=ae(t.buttonRef,n),d=re(),{id:f=`headlessui-combobox-button-${d}`,...a}=e,r=ye(),o=x(I=>{switch(I.key){case M.ArrowDown:return I.preventDefault(),I.stopPropagation(),t.comboboxState===1&&l.openCombobox(),r.nextFrame(()=>{var C;return(C=t.inputRef.current)==null?void 0:C.focus({preventScroll:!0})});case M.ArrowUp:return I.preventDefault(),I.stopPropagation(),t.comboboxState===1&&(l.openCombobox(),r.nextFrame(()=>{t.value||l.goToOption(S.Last)})),r.nextFrame(()=>{var C;return(C=t.inputRef.current)==null?void 0:C.focus({preventScroll:!0})});case M.Escape:return t.comboboxState!==0?void 0:(I.preventDefault(),t.optionsRef.current&&!t.optionsPropsRef.current.static&&I.stopPropagation(),l.closeCombobox(),r.nextFrame(()=>{var C;return(C=t.inputRef.current)==null?void 0:C.focus({preventScroll:!0})}));default:return}}),i=x(I=>{if(Ye(I.currentTarget))return I.preventDefault();t.comboboxState===0?l.closeCombobox():(I.preventDefault(),l.openCombobox()),r.nextFrame(()=>{var C;return(C=t.inputRef.current)==null?void 0:C.focus({preventScroll:!0})})}),E=ce([f]),{isFocusVisible:v,focusProps:m}=ge({isTextInput:!0,autoFocus:(V=e.autoFocus)!=null?V:!1}),{isHovered:b,hoverProps:L}=ve({isDisabled:(k=t.disabled)!=null?k:!1}),{pressed:P,pressProps:O}=he({disabled:(N=t.disabled)!=null?N:!1}),T=j(()=>({open:t.comboboxState===0,active:P||t.comboboxState===0,disabled:t.disabled,value:t.value,hover:b,focus:v}),[t,b,v,P]),_=be({ref:p,id:f,type:ke(e,t.buttonRef),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(G=t.optionsRef.current)==null?void 0:G.id,"aria-expanded":t.comboboxState===0,"aria-labelledby":E,disabled:t.disabled,onClick:i,onKeyDown:o},m,L,O);return Y({ourProps:_,theirProps:a,slot:T,defaultTag:mo,name:"Combobox.Button"})}let xo="ul",go=Ee.RenderStrategy|Ee.Static;function vo(e,n){var O;let t=re(),{id:l=`headlessui-combobox-options-${t}`,hold:p=!1,anchor:d,...f}=e,a=z("Combobox.Options"),[r,o]=je(d),i=Ke(),E=ae(a.optionsRef,n,d?r:null),v=qe(),m=(()=>v!==null?(v&ie.Open)===ie.Open:a.comboboxState===0)();K(()=>{var T;a.optionsPropsRef.current.static=(T=e.static)!=null?T:!1},[a.optionsPropsRef,e.static]),K(()=>{a.optionsPropsRef.current.hold=p},[a.optionsPropsRef,p]),Ge({container:a.optionsRef.current,enabled:a.comboboxState===0,accept(T){return T.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:T.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(T){T.setAttribute("role","none")}});let b=ce([(O=a.buttonRef.current)==null?void 0:O.id]),L=j(()=>({open:a.comboboxState===0,option:void 0}),[a]),P=be(d?i():{},{"aria-labelledby":b,role:"listbox","aria-multiselectable":a.mode===1?!0:void 0,id:l,ref:E,...o?{style:o}:{}});return a.virtual&&a.comboboxState===0&&Object.assign(f,{children:w.createElement(uo,null,f.children)}),Y({ourProps:P,theirProps:f,slot:L,defaultTag:xo,features:go,visible:m,name:"Combobox.Options"})}let Oo="li";function Co(e,n){var X;let t=re(),{id:l=`headlessui-combobox-option-${t}`,disabled:p=!1,value:d,order:f=null,...a}=e,r=z("Combobox.Option"),o=le("Combobox.Option"),i=r.virtual?r.activeOptionIndex===r.calculateIndex(d):r.activeOptionIndex===null?!1:((X=r.options[r.activeOptionIndex])==null?void 0:X.id)===l,E=r.isSelected(d),v=H(null),m=Be({disabled:p,value:d,domRef:v,order:f}),b=de(Ie),L=ae(n,v,b?b.measureElement:null),P=x(()=>o.onChange(d));K(()=>o.registerOption(l,m),[m,l]);let O=H(!(r.virtual||r.__demoMode));K(()=>{if(!r.virtual||!r.__demoMode)return;let A=Se();return A.requestAnimationFrame(()=>{O.current=!0}),A.dispose},[r.virtual,r.__demoMode]),K(()=>{if(!O.current||r.comboboxState!==0||!i||r.activationTrigger===0)return;let A=Se();return A.requestAnimationFrame(()=>{var R,s;(s=(R=v.current)==null?void 0:R.scrollIntoView)==null||s.call(R,{block:"nearest"})}),A.dispose},[v,i,r.comboboxState,r.activationTrigger,r.activeOptionIndex]);let T=x(A=>{var R;if(p||(R=r.virtual)!=null&&R.disabled(d))return A.preventDefault();P(),Ze()||requestAnimationFrame(()=>{var s;return(s=r.inputRef.current)==null?void 0:s.focus({preventScroll:!0})}),r.mode===0&&requestAnimationFrame(()=>o.closeCombobox())}),_=x(()=>{var R;if(p||(R=r.virtual)!=null&&R.disabled(d))return o.goToOption(S.Nothing);let A=r.calculateIndex(d);o.goToOption(S.Specific,A)}),V=Ne(),k=x(A=>V.update(A)),N=x(A=>{var s;if(!V.wasMoved(A)||p||(s=r.virtual)!=null&&s.disabled(d)||i)return;let R=r.calculateIndex(d);o.goToOption(S.Specific,R,0)}),G=x(A=>{var R;V.wasMoved(A)&&(p||(R=r.virtual)!=null&&R.disabled(d)||i&&(r.optionsPropsRef.current.hold||o.goToOption(S.Nothing)))}),I=j(()=>({active:i,focus:i,selected:E,disabled:p}),[i,E,p]);return Y({ourProps:{id:l,ref:L,role:"option",tabIndex:p===!0?void 0:-1,"aria-disabled":p===!0?!0:void 0,"aria-selected":E,disabled:void 0,onClick:T,onFocus:_,onPointerEnter:k,onMouseEnter:k,onPointerMove:N,onMouseMove:N,onPointerLeave:G,onMouseLeave:G},theirProps:a,slot:I,defaultTag:Oo,name:"Combobox.Option"})}let yo=q(bo),Ro=q(To),Ao=q(fo),Po=oo,So=q(vo),Eo=q(Co),st=Object.assign(yo,{Input:Ao,Button:Ro,Label:Po,Options:So,Option:Eo});export{st as Combobox,Ro as ComboboxButton,Ao as ComboboxInput,Po as ComboboxLabel,Eo as ComboboxOption,So as ComboboxOptions};
