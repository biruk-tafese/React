"use client";import s,{createContext as _e,createRef as Re,useCallback as q,useContext as z,useEffect as H,useMemo as P,useReducer as Ce,useRef as Q,useState as Oe}from"react";import{useDocumentOverflowLockedEffect as ve}from'../../hooks/document-overflow/use-document-overflow.js';import{useEvent as _}from'../../hooks/use-event.js';import{useEventListener as Fe}from'../../hooks/use-event-listener.js';import{useId as R}from'../../hooks/use-id.js';import{useInert as Z}from'../../hooks/use-inert.js';import{useIsTouchDevice as be}from'../../hooks/use-is-touch-device.js';import{useOutsideClick as Le}from'../../hooks/use-outside-click.js';import{useOwnerDocument as xe}from'../../hooks/use-owner.js';import{useRootContainers as he}from'../../hooks/use-root-containers.js';import{useServerHandoffComplete as Se}from'../../hooks/use-server-handoff-complete.js';import{useSyncRefs as C}from'../../hooks/use-sync-refs.js';import{HoistFormFields as ke}from'../../internal/form-fields.js';import{State as k,useOpenClosed as Ie}from'../../internal/open-closed.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{StackMessage as ee,StackProvider as Me}from'../../internal/stack-context.js';import{isDisabledReactIssue7711 as Ge}from'../../utils/bugs.js';import{match as U}from'../../utils/match.js';import{RenderFeatures as te,forwardRefWithAs as O,render as v}from'../../utils/render.js';import{Description as oe,useDescriptions as we}from'../description/description.js';import{FocusTrap as He,FocusTrapFeatures as E}from'../focus-trap/focus-trap.js';import{Keys as Be}from'../keyboard.js';import{Portal as N,useNestedPortals as Ue}from'../portal/portal.js';var Ne=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(Ne||{}),We=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(We||{});let Ye={[0](t,e){return t.titleId===e.id?t:{...t,titleId:e.id}}},I=_e(null);I.displayName="DialogContext";function F(t){let e=z(I);if(e===null){let r=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,F),r}return e}function $e(t,e,r=()=>[document.body]){ve(t,e,i=>{var n;return{containers:[...(n=i.containers)!=null?n:[],r]}})}function je(t,e){return U(e.type,Ye,t,e)}let Je="div",Ke=te.RenderStrategy|te.Static;function Ve(t,e){let r=R(),{id:i=`headlessui-dialog-${r}`,open:n,onClose:l,initialFocus:p,role:a="dialog",autoFocus:T=!0,__demoMode:m=!1,...M}=t,[f,W]=Oe(0),Y=Q(!1);a=function(){return a==="dialog"||a==="alertdialog"?a:(Y.current||(Y.current=!0,console.warn(`Invalid role [${a}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let A=Ie();n===void 0&&A!==null&&(n=(A&k.Open)===k.Open);let c=Q(null),re=C(c,e),g=xe(c),$=t.hasOwnProperty("open")||A!==null,j=t.hasOwnProperty("onClose");if(!$&&!j)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!$)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!j)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof n!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${n}`);if(typeof l!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${l}`);let d=n?0:1,[b,ne]=Ce(je,{titleId:null,descriptionId:null,panelRef:Re()}),y=_(()=>l(!1)),J=_(o=>ne({type:0,id:o})),L=Se()?m?!1:d===0:!1,x=f>1,K=z(I)!==null,[le,ae]=Ue(),ie={get current(){var o;return(o=b.panelRef.current)!=null?o:c.current}},{resolveContainers:G,mainTreeNodeRef:h,MainTreeNode:se}=he({portals:le,defaultContainers:[ie]}),pe=x?"parent":"leaf",V=A!==null?(A&k.Closing)===k.Closing:!1,de=(()=>K||V?!1:L)(),ue=q(()=>{var o,D;return(D=Array.from((o=g==null?void 0:g.querySelectorAll("body > *"))!=null?o:[]).find(u=>u.id==="headlessui-portal-root"?!1:u.contains(h.current)&&u instanceof HTMLElement))!=null?D:null},[h]);Z(ue,de);let fe=(()=>x?!0:L)(),ge=q(()=>{var o,D;return(D=Array.from((o=g==null?void 0:g.querySelectorAll("[data-headlessui-portal]"))!=null?o:[]).find(u=>u.contains(h.current)&&u instanceof HTMLElement))!=null?D:null},[h]);Z(ge,fe);let Te=(()=>!(!L||x))();Le(G,y,Te);let ce=(()=>!(x||d!==0))();Fe(g==null?void 0:g.defaultView,"keydown",o=>{ce&&(o.defaultPrevented||o.key===Be.Escape&&(o.preventDefault(),o.stopPropagation(),y()))});let De=(()=>!(V||d!==0||K))();$e(g,De,G),H(()=>{if(d!==0||!c.current)return;let o=new ResizeObserver(D=>{for(let u of D){let S=u.target.getBoundingClientRect();S.x===0&&S.y===0&&S.width===0&&S.height===0&&y()}});return o.observe(c.current),()=>o.disconnect()},[d,c,y]);let[me,ye]=we(),Pe=P(()=>[{dialogState:d,close:y,setTitleId:J},b],[d,b,y,J]),X=P(()=>({open:d===0}),[d]),Ee={ref:re,id:i,role:a,tabIndex:-1,"aria-modal":d===0?!0:void 0,"aria-labelledby":b.titleId,"aria-describedby":me},Ae=!be(),w=L?U(pe,{parent:E.RestoreFocus,leaf:E.All&~E.FocusLock}):E.None;return T&&(w|=E.AutoFocus),Ae||(w&=~E.InitialFocus),s.createElement(Me,{type:"Dialog",enabled:d===0,element:c,onUpdate:_((o,D)=>{D==="Dialog"&&U(o,{[ee.Add]:()=>W(u=>u+1),[ee.Remove]:()=>W(u=>u-1)})})},s.createElement(B,{force:!0},s.createElement(N,null,s.createElement(I.Provider,{value:Pe},s.createElement(N.Group,{target:c},s.createElement(B,{force:!1},s.createElement(ye,{slot:X,name:"Dialog.Description"},s.createElement(ae,null,s.createElement(He,{initialFocus:p,initialFocusFallback:c,containers:G,features:w},v({ourProps:Ee,theirProps:M,slot:X,defaultTag:Je,features:Ke,visible:d===0,name:"Dialog"}))))))))),s.createElement(ke,null,s.createElement(se,null)))}let Xe="div";function qe(t,e){let r=R(),{id:i=`headlessui-dialog-overlay-${r}`,...n}=t,[{dialogState:l,close:p}]=F("Dialog.Overlay"),a=C(e),T=_(f=>{if(f.target===f.currentTarget){if(Ge(f.currentTarget))return f.preventDefault();f.preventDefault(),f.stopPropagation(),p()}}),m=P(()=>({open:l===0}),[l]);return v({ourProps:{ref:a,id:i,"aria-hidden":!0,onClick:T},theirProps:n,slot:m,defaultTag:Xe,name:"Dialog.Overlay"})}let ze="div";function Qe(t,e){let r=R(),{id:i=`headlessui-dialog-backdrop-${r}`,...n}=t,[{dialogState:l},p]=F("Dialog.Backdrop"),a=C(e);H(()=>{if(p.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[p.panelRef]);let T=P(()=>({open:l===0}),[l]);return s.createElement(B,{force:!0},s.createElement(N,null,v({ourProps:{ref:a,id:i,"aria-hidden":!0},theirProps:n,slot:T,defaultTag:ze,name:"Dialog.Backdrop"})))}let Ze="div";function et(t,e){let r=R(),{id:i=`headlessui-dialog-panel-${r}`,...n}=t,[{dialogState:l},p]=F("Dialog.Panel"),a=C(e,p.panelRef),T=P(()=>({open:l===0}),[l]),m=_(f=>{f.stopPropagation()});return v({ourProps:{ref:a,id:i,onClick:m},theirProps:n,slot:T,defaultTag:Ze,name:"Dialog.Panel"})}let tt="h2";function ot(t,e){let r=R(),{id:i=`headlessui-dialog-title-${r}`,...n}=t,[{dialogState:l,setTitleId:p}]=F("Dialog.Title"),a=C(e);H(()=>(p(i),()=>p(null)),[i,p]);let T=P(()=>({open:l===0}),[l]);return v({ourProps:{ref:a,id:i},theirProps:n,slot:T,defaultTag:tt,name:"Dialog.Title"})}let rt=O(Ve),nt=O(Qe),lt=O(et),at=O(qe),it=O(ot),St=oe,kt=Object.assign(rt,{Backdrop:nt,Panel:lt,Overlay:at,Title:it,Description:oe});export{kt as Dialog,nt as DialogBackdrop,St as DialogDescription,at as DialogOverlay,lt as DialogPanel,it as DialogTitle};
